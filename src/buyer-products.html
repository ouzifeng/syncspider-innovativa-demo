<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>My Pricing | Innovativa Client Portal</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EðŸ“¦%3C/text%3E%3C/svg%3E">
  </head>
  <body
    x-data="{
      page: 'buyerProducts',
      'loaded': true,
      'darkMode': false,
      'pendingQuotes': 2,
      'user': {
        name: 'Emma Thompson',
        email: 'emma@luxebeauty.co.uk',
        company: 'Luxe Beauty Co',
        role: 'Owner'
      },

      // Filters
      searchQuery: '',
      filterStatus: 'all',
      sortBy: 'recent',

      // Products with pricing (client's view - only sees their COGS, not supplier cost)
      products: [
        {
          id: 1,
          name: 'Silk Hair Serum 50ml',
          sku: 'SHS-50',
          image: 'https://via.placeholder.com/80',
          status: 'quoted',
          requestedDate: '2025-12-10',
          quotedDate: '2025-12-12',
          pricing: {
            'US': {
              shipping: 4.50,
              '1': { single: 3.20, upsell: 2.90 },
              '3': { single: 2.85, upsell: 2.60 }
            },
            'UK': {
              shipping: 5.20,
              '1': { single: 3.50, upsell: 3.20 },
              '3': { single: 3.10, upsell: 2.85 }
            }
          }
        },
        {
          id: 2,
          name: 'Vitamin C Face Cream 100ml',
          sku: 'VFC-100',
          image: 'https://via.placeholder.com/80',
          status: 'pending',
          requestedDate: '2025-12-14',
          quotedDate: null,
          pricing: null
        },
        {
          id: 3,
          name: 'Retinol Night Serum 30ml',
          sku: 'RNS-30',
          image: 'https://via.placeholder.com/80',
          status: 'pending',
          requestedDate: '2025-12-14',
          quotedDate: null,
          pricing: null
        },
        {
          id: 4,
          name: 'Hyaluronic Acid Mask (5pk)',
          sku: 'HAM-5PK',
          image: 'https://via.placeholder.com/80',
          status: 'quoted',
          requestedDate: '2025-12-05',
          quotedDate: '2025-12-08',
          pricing: {
            'US': {
              shipping: 3.80,
              '1': { single: 2.85, upsell: 2.55 },
              '3': { single: 2.50, upsell: 2.25 }
            },
            'UK': {
              shipping: 4.50,
              '1': { single: 3.15, upsell: 2.85 },
              '3': { single: 2.80, upsell: 2.50 }
            }
          }
        },
        {
          id: 5,
          name: 'Rose Hip Oil 30ml',
          sku: 'RHO-30',
          image: 'https://via.placeholder.com/80',
          status: 'quoted',
          requestedDate: '2025-12-01',
          quotedDate: '2025-12-04',
          pricing: {
            'US': {
              shipping: 3.50,
              '1': { single: 2.10, upsell: 1.90 },
              '3': { single: 1.85, upsell: 1.65 }
            },
            'UK': {
              shipping: 4.20,
              '1': { single: 2.40, upsell: 2.15 },
              '3': { single: 2.10, upsell: 1.90 }
            }
          }
        },
        {
          id: 6,
          name: 'Gentle Cleanser 200ml',
          sku: 'GCL-200',
          image: 'https://via.placeholder.com/80',
          status: 'quoted',
          requestedDate: '2025-11-28',
          quotedDate: '2025-12-01',
          pricing: {
            'US': {
              shipping: 4.00,
              '1': { single: 1.95, upsell: 1.75 },
              '3': { single: 1.70, upsell: 1.50 }
            },
            'UK': {
              shipping: 4.80,
              '1': { single: 2.25, upsell: 2.00 },
              '3': { single: 1.95, upsell: 1.75 }
            }
          }
        }
      ],

      // Pricing detail modal
      showPricingModal: false,
      selectedProduct: null,

      get filteredProducts() {
        let filtered = this.products;

        if (this.filterStatus !== 'all') {
          filtered = filtered.filter(p => p.status === this.filterStatus);
        }

        if (this.searchQuery) {
          const query = this.searchQuery.toLowerCase();
          filtered = filtered.filter(p =>
            p.name.toLowerCase().includes(query) ||
            p.sku.toLowerCase().includes(query)
          );
        }

        if (this.sortBy === 'recent') {
          filtered = [...filtered].sort((a, b) => new Date(b.requestedDate) - new Date(a.requestedDate));
        } else if (this.sortBy === 'name') {
          filtered = [...filtered].sort((a, b) => a.name.localeCompare(b.name));
        } else if (this.sortBy === 'status') {
          filtered = [...filtered].sort((a, b) => a.status.localeCompare(b.status));
        }

        return filtered;
      },

      get quotedCount() {
        return this.products.filter(p => p.status === 'quoted').length;
      },

      get pendingCount() {
        return this.products.filter(p => p.status === 'pending').length;
      },

      openPricingModal(product) {
        this.selectedProduct = product;
        this.showPricingModal = true;
      },

      closePricingModal() {
        this.showPricingModal = false;
        this.selectedProduct = null;
      },

      getStatusColor(status) {
        if (status === 'quoted') return 'bg-emerald-50 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-400';
        if (status === 'pending') return 'bg-amber-50 text-amber-700 dark:bg-amber-900/20 dark:text-amber-400';
        return 'bg-gray-50 text-gray-700 dark:bg-gray-900/20 dark:text-gray-400';
      },

      formatPrice(amount) {
        if (amount === null || amount === undefined) return 'â€”';
        return '$' + amount.toFixed(2);
      },

      getLowestPrice(product) {
        if (!product.pricing) return null;
        let lowest = Infinity;
        Object.values(product.pricing).forEach(countryPricing => {
          Object.values(countryPricing).forEach(qtyPricing => {
            if (qtyPricing.single < lowest) lowest = qtyPricing.single;
            if (qtyPricing.upsell < lowest) lowest = qtyPricing.upsell;
          });
        });
        return lowest === Infinity ? null : lowest;
      }
    }"
    x-init="
         darkMode = JSON.parse(localStorage.getItem('darkMode'));
         $watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)));

         // Check URL for filter param
         const urlParams = new URLSearchParams(window.location.search);
         if (urlParams.get('filter') === 'pending') {
           filterStatus = 'pending';
         }
    "
    :class="{'dark bg-gray-900': darkMode === true}"
  >
    <!-- ===== Preloader Start ===== -->
    <include src="./partials/preloader.html"></include>
    <!-- ===== Preloader End ===== -->

    <!-- ===== Page Container ===== -->
    <div class="flex min-h-screen flex-col bg-gray-50 dark:bg-gray-900">
      <!-- ===== Top Navigation Bar ===== -->
      <include src="./partials/buyer-nav.html"></include>

      <!-- ===== Main Content ===== -->
      <main class="flex-1 py-8">
        <div class="mx-auto max-w-screen-2xl px-4 sm:px-6 lg:px-8">
          <!-- Page Header -->
          <div class="mb-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <h1 class="text-3xl font-bold text-gray-900 dark:text-white">My Pricing</h1>
              <p class="mt-2 text-gray-600 dark:text-gray-400">
                View your product sourcing costs
              </p>
            </div>
            <a href="quote-request.html" class="inline-flex items-center gap-2 rounded-lg bg-emerald-600 px-4 py-2 text-sm font-medium text-white hover:bg-emerald-700">
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
              </svg>
              Request New Quote
            </a>
          </div>

          <!-- Stats Cards -->
          <div class="mb-6 grid grid-cols-1 gap-4 sm:grid-cols-3">
            <div class="rounded-xl border border-gray-200 bg-white p-4 dark:border-gray-700 dark:bg-gray-800">
              <p class="text-sm text-gray-500 dark:text-gray-400">Total Products</p>
              <p class="text-2xl font-bold text-gray-900 dark:text-white" x-text="products.length"></p>
            </div>
            <div class="rounded-xl border border-emerald-200 bg-emerald-50 p-4 dark:border-emerald-800 dark:bg-emerald-900/20">
              <p class="text-sm text-emerald-700 dark:text-emerald-400">Quoted</p>
              <p class="text-2xl font-bold text-emerald-600 dark:text-emerald-400" x-text="quotedCount"></p>
            </div>
            <div class="rounded-xl border border-amber-200 bg-amber-50 p-4 dark:border-amber-800 dark:bg-amber-900/20">
              <p class="text-sm text-amber-700 dark:text-amber-400">Pending</p>
              <p class="text-2xl font-bold text-amber-600 dark:text-amber-400" x-text="pendingCount"></p>
            </div>
          </div>

          <!-- Filters Bar -->
          <div class="mb-6 flex flex-col gap-4 rounded-xl border border-gray-200 bg-white p-4 sm:flex-row sm:items-center dark:border-gray-700 dark:bg-gray-800">
            <!-- Search -->
            <div class="relative flex-1">
              <input
                type="search"
                x-model="searchQuery"
                placeholder="Search products or SKU..."
                class="h-10 w-full rounded-lg border border-gray-300 pr-4 pl-10 text-sm focus:border-transparent focus:ring-2 focus:ring-emerald-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400"
              />
              <svg class="absolute top-2.5 left-3 h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>

            <!-- Status Filter -->
            <select
              x-model="filterStatus"
              class="h-10 rounded-lg border border-gray-300 px-3 text-sm focus:ring-2 focus:ring-emerald-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white"
            >
              <option value="all">All Status</option>
              <option value="quoted">Quoted</option>
              <option value="pending">Pending</option>
            </select>

            <!-- Sort By -->
            <select
              x-model="sortBy"
              class="h-10 rounded-lg border border-gray-300 px-3 text-sm focus:ring-2 focus:ring-emerald-500 focus:outline-none dark:border-gray-600 dark:bg-gray-700 dark:text-white"
            >
              <option value="recent">Most Recent</option>
              <option value="name">Name (A-Z)</option>
              <option value="status">Status</option>
            </select>
          </div>

          <!-- Products Table -->
          <div class="rounded-xl border border-gray-200 bg-white dark:border-gray-700 dark:bg-gray-800">
            <div class="overflow-x-auto">
              <table class="w-full">
                <thead class="border-b border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-900/50">
                  <tr>
                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase text-gray-600 dark:text-gray-400">Product</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase text-gray-600 dark:text-gray-400">SKU</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase text-gray-600 dark:text-gray-400">Your COGS</th>
                    <th class="px-6 py-4 text-left text-xs font-semibold uppercase text-gray-600 dark:text-gray-400">Status</th>
                    <th class="px-6 py-4 text-right text-xs font-semibold uppercase text-gray-600 dark:text-gray-400">Actions</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                  <template x-for="product in filteredProducts" :key="product.id">
                    <tr class="transition-colors hover:bg-gray-50 dark:hover:bg-gray-700/50">
                      <!-- Product -->
                      <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                          <div class="h-12 w-12 flex-shrink-0 overflow-hidden rounded-lg bg-gray-100 dark:bg-gray-700">
                            <img :src="product.image" :alt="product.name" class="h-full w-full object-cover">
                          </div>
                          <div>
                            <p class="font-medium text-gray-900 dark:text-white" x-text="product.name"></p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">
                              Requested: <span x-text="product.requestedDate"></span>
                            </p>
                          </div>
                        </div>
                      </td>

                      <!-- SKU -->
                      <td class="px-6 py-4">
                        <span class="font-mono text-sm text-gray-600 dark:text-gray-400" x-text="product.sku"></span>
                      </td>

                      <!-- Your COGS -->
                      <td class="px-6 py-4">
                        <template x-if="product.status === 'quoted'">
                          <div>
                            <span class="text-lg font-semibold text-emerald-600 dark:text-emerald-400" x-text="'from ' + formatPrice(getLowestPrice(product))"></span>
                          </div>
                        </template>
                        <template x-if="product.status === 'pending'">
                          <span class="text-gray-400">Awaiting quote</span>
                        </template>
                      </td>

                      <!-- Status -->
                      <td class="px-6 py-4">
                        <span class="rounded-full px-2 py-1 text-xs font-medium capitalize" :class="getStatusColor(product.status)" x-text="product.status"></span>
                      </td>

                      <!-- Actions -->
                      <td class="px-6 py-4 text-right">
                        <template x-if="product.status === 'quoted'">
                          <button
                            @click="openPricingModal(product)"
                            class="rounded-lg bg-emerald-600 px-3 py-1.5 text-xs font-medium text-white hover:bg-emerald-700"
                          >
                            View Pricing
                          </button>
                        </template>
                        <template x-if="product.status === 'pending'">
                          <span class="text-xs text-gray-400">Processing...</span>
                        </template>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>

            <!-- Empty State -->
            <div x-show="filteredProducts.length === 0" class="py-12 text-center">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
              </svg>
              <p class="mt-4 text-gray-500 dark:text-gray-400">No products found</p>
              <a href="quote-request.html" class="mt-2 inline-block text-sm font-medium text-emerald-600 hover:text-emerald-700 dark:text-emerald-400">
                Request a quote â†’
              </a>
            </div>
          </div>
        </div>
      </main>

      <!-- ===== Pricing Detail Modal ===== -->
      <div
        x-show="showPricingModal"
        x-transition:enter="transition ease-out duration-200"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-150"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4"
        @click.self="closePricingModal()"
      >
        <div
          x-show="showPricingModal"
          x-transition:enter="transition ease-out duration-200"
          x-transition:enter-start="opacity-0 scale-95"
          x-transition:enter-end="opacity-100 scale-100"
          x-transition:leave="transition ease-in duration-150"
          x-transition:leave-start="opacity-100 scale-100"
          x-transition:leave-end="opacity-0 scale-95"
          class="w-full max-w-2xl rounded-2xl bg-white shadow-xl dark:bg-gray-800"
        >
          <!-- Modal Header -->
          <div class="flex items-center justify-between border-b border-gray-200 p-6 dark:border-gray-700">
            <div>
              <h2 class="text-xl font-bold text-gray-900 dark:text-white" x-text="selectedProduct?.name"></h2>
              <p class="text-sm text-gray-500 dark:text-gray-400">
                SKU: <span x-text="selectedProduct?.sku"></span>
              </p>
            </div>
            <button @click="closePricingModal()" class="rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600 dark:hover:bg-gray-700">
              <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>

          <!-- Modal Body -->
          <div class="max-h-[60vh] overflow-y-auto p-6">
            <p class="mb-4 text-sm text-gray-600 dark:text-gray-400">
              Your COGS (Cost of Goods Sold) pricing by destination and quantity:
            </p>

            <template x-if="selectedProduct?.pricing">
              <div class="space-y-6">
                <template x-for="(countryPricing, country) in selectedProduct.pricing" :key="country">
                  <div class="rounded-lg border border-gray-200 dark:border-gray-700">
                    <div class="border-b border-gray-200 bg-gray-50 px-4 py-3 dark:border-gray-700 dark:bg-gray-900/50 flex justify-between items-center">
                      <h4 class="font-semibold text-gray-900 dark:text-white" x-text="country === 'US' ? 'United States' : country === 'UK' ? 'United Kingdom' : country"></h4>
                      <div class="text-sm">
                        <span class="text-gray-500 dark:text-gray-400">Shipping:</span>
                        <span class="font-semibold text-blue-600 dark:text-blue-400" x-text="formatPrice(countryPricing.shipping)"></span>
                      </div>
                    </div>
                    <div class="p-4">
                      <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">Product cost per unit:</p>
                      <table class="w-full">
                        <thead>
                          <tr class="text-xs text-gray-500 dark:text-gray-400">
                            <th class="pb-2 text-left font-medium">Quantity</th>
                            <th class="pb-2 text-right font-medium">Single</th>
                            <th class="pb-2 text-right font-medium">Upsell</th>
                          </tr>
                        </thead>
                        <tbody>
                          <template x-for="(qtyPricing, qty) in countryPricing" :key="qty">
                            <template x-if="qty !== 'shipping'">
                              <tr class="border-t border-gray-100 dark:border-gray-700">
                                <td class="py-2 text-gray-700 dark:text-gray-300" x-text="qty + ' unit' + (qty > 1 ? 's' : '')"></td>
                                <td class="py-2 text-right font-semibold text-emerald-600 dark:text-emerald-400" x-text="formatPrice(qtyPricing.single)"></td>
                                <td class="py-2 text-right font-semibold text-blue-600 dark:text-blue-400" x-text="formatPrice(qtyPricing.upsell)"></td>
                              </tr>
                            </template>
                          </template>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </template>
              </div>
            </template>

            <!-- Pricing Legend -->
            <div class="mt-6 flex flex-wrap gap-4 text-xs text-gray-500 dark:text-gray-400">
              <div class="flex items-center gap-2">
                <div class="h-3 w-3 rounded bg-emerald-500"></div>
                <span>Single: Standard order pricing (per unit)</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="h-3 w-3 rounded bg-blue-500"></div>
                <span>Upsell: Bundle/upsell pricing (per unit)</span>
              </div>
              <div class="flex items-center gap-2">
                <div class="h-3 w-3 rounded bg-blue-500"></div>
                <span>Shipping: Per order fulfillment cost</span>
              </div>
            </div>
          </div>

          <!-- Modal Footer -->
          <div class="flex justify-end border-t border-gray-200 p-6 dark:border-gray-700">
            <button @click="closePricingModal()" class="rounded-lg bg-gray-100 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">
              Close
            </button>
          </div>
        </div>
      </div>

      <!-- ===== Footer ===== -->
      <footer class="mt-8 border-t border-gray-200 bg-white py-6 dark:border-gray-700 dark:bg-gray-800">
        <div class="mx-auto max-w-screen-2xl px-4 sm:px-6 lg:px-8">
          <div class="flex flex-col items-center justify-between gap-4 sm:flex-row">
            <p class="text-sm text-gray-500 dark:text-gray-400">
              Â© 2025 Innovativa. All rights reserved.
            </p>
            <div class="flex items-center gap-6 text-sm">
              <a href="#" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                Help & Support
              </a>
              <a href="#" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-300">
                Terms & Conditions
              </a>
            </div>
          </div>
        </div>
      </footer>
    </div>
    <!-- ===== Page Container End ===== -->
  </body>
</html>
